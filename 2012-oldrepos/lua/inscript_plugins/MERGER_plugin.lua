PLUGIN.Name = "MERGERPATTERN"
PLUGIN.DefaultOn = false
PLUGIN.Description = ""
PLUGIN.Trigger = true

function PLUGIN:Load()
GUNSTRUMENTAL_MERGE =  [[b3......................C4..d4..F4......b3......d4......F4......g4......b3......C4......g4......F4......................F4......f4......b3......C4......f4......e4..........d4..........C4......A3......................C4..d4..F4......e4..F4..A3..............b3..............C4......d4..C4..b3..........d4..........F4......g4......a4......b4......g4......F4......................F4......f4......C4......G4......C4......b4......f4......G4......b4......C5..............................b4..A4..F4..............d4..C4..e4......c5......b4..c5..b4......d5......c5......b4..c5..b4..g4..a4......e5......d5..e5..d5..e5..g5......e5......d5......e5......e4......c5......b4..c5..b4......d5......c5......b4..c5..b4..g4..a4......e5......d5..e5..d5..e5..G5......e5......d5......e5......e4......c5......b4..c5..b4......d5......c5......b4..c5..b4..g4..a4......e5......d5..e5..d5..e5..g5......e5......d5......e5......e4......c5......b4..c5..b4......d5......c5......b4..c5..b4..g4..a4......e5......d5..e5..d5..e5..g5..............a5................C5......................C5..C5..C5..........b4..........C5..............C5......C5..............C5..........b4..........C5......G4..........e5..........D5......C5..........b4..........C5......................................................................C5......................C5..C5..C5..........G5..........C5..............C5......C5..............C5..........F5..........G5......C6..............................................................................................C6......G5......C4......e4......F4..............................G4......a4......C5..............F4......................................C5......F5......G5......a5..............F5..............G5..............e5..............C5..............................................................F4..............................G4......a4......C5..............F4..............................f4..............................F4......G4......a4......C5......a4......G4......F4......G4......a4......b4......C5......e5......F5............................d5..............d5......d5..............d5......d5..............C5..............C5......e5..............e5......F5..............d5......................C5......................d5..............................................................................b4..............b4......b4..............b4......b4..............C5..............C5......C5..............C5......C5..............C5..............C5......C5..............C5......C5..............F5......................F5......................F5..............d5..............d5......d5..............d5......d5..............C5..............C5......e5..............e5......F5..............d5......................C5......................d5..............................................................................b4..............b4......b4..............b4......b4..............C5..............C5......C5..............C5......C5..............C5..............C5......C5..............C5......C5..............F5......................F5......................F5..............................a4......c5......d5......c5......d5......c5......d5..........f5..........e5......d5......c5......d5......c5......d5..........a5..........g5......f5..........e5..........d5......C5..........a4..........g4......a4..............................................a4......c5......d5......c5......d5......c5......d5..........f5..........e5......d5......c5......d5......c5......d5..........a5..........g5......f5..........e5..........d5......e5..........f5..........g5......a5......................a5........................D5..............D5..............D5..........D5..........D5..............C5......C5..............C5..........C5..........A4......................A4..............A4..........A4..........A4..............A4......A4..............A4..........A4..........C5......D5..............D5..............D5..........D5..........D5..............f5......f5..............f5..........f5..........D5......................D5..............D5..........D5..........D5..............D5......D5..............D5..........D5..........D5......D5..............D5..............D5..........D5..........D5..............C5......C5..............C5..........C5..........A4......................A4..............A4..........A4..........A4..............A4......A4..............A4..........A4..........C5......D5..............D5..............D5..........D5..........D5..............f5......f5..............f5..........f5..........d5......................d5..............d5..........d5..........d5..............A5......A5..............A5..........A5..........A5......A5..f5....C5....A5..f5....C5....A5..f5....C5....A5..f5....C5....A5..f5....C5....A5..f5....C5....A5..f5....C5....A5..f5....C5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....a5..f5....d5....g5..e5....c5....g5..e5....c5....f5..............e5..f5....g5....d5......................a4..c5..d5......a4......d5......a4......e5......c5......e5......c5......f5..............e5..f5....g5....a5......................f5..g5..a5..f5....d5....a5..f5....d5....g5..e5....c5....g5..e5....c5....f5..............e5..f5....g5....d5......................a4..c5..d5......a4......d5......a4......e5......c5......e5......c5......f5......C5......f5......C5......a5........a5........a5..........
F3..............................................................b2..............................b2..............................G2..............................e3..............................F3..............................A2..............F3..............F3..............................................................b2..............................F3..............................G2..............f3..............f2..............C3..............F3..............................C3..............F3..............e3..............................d3..............................C3..............................c3..............d3..............a2..............................b2..............................c3..............................a3..............b3..............e3..............................d3..............................C3..............................c3..............d3..............a2..............................b2..............................c3..............................a3..............b3..............................e3..............................................b2..............F3..............................................C3..............................b2..............................A2..............................................................a2..............................................................b2..............................................................C3..............................................................C3......D3......e3......G3......C4......D4......e4........................a3......d4..............e3......b3......e4..............F3......a3......C4......a3......F3..............................d3......a3......d4..............e3......b3......e4..............C3......G3......C4......G3......C3......G3......C4......G3......b2......F3......b3..............C3......G3......C4..............d3......a3......d4..............C3......G3......C4..............d3......F3......a3......F3......e3......G3......b3......G3......d3..............e3..............F3............................................................................................e3..............................................................F3......................F3......................e3..............................................................................g2..............................................................a2..............................................................A2..............................................................................................................................................................................................e3..............................................................F3......................F3......................e3..............................................................................g2..............................................................a2..............................................................A2..............................................................................................................................................c3..............A2......f3......A2......A2......A2..............................c3......c3......c3......c3......c3..............................C3..............................C3..............................d3......d3......d3......d3......d3......d3......d3......d3......A2......A2......A2......A2......A2..............................c3......c3......c3......c3......c3..............................C3..............................C3..............................e3......................a2........................b2......D3......F3......D3......b2..........D3..........F3......C3......f3......G3......f3......C3..........f3..........G3......D3......F3......A3......F3......D3..........F3..........A3......D3......F3......A3......F3......D3..........F3..........A3......b2......D3......F3......D3......b2..........D3..........F3......C3......f3......G3......f3......C3..........f3..........G3......D3......F3......A3......F3......D3..........F3..........A3......D3......F3......A3......F3......D3..........F3..........A3......b2......D3......F3......D3......b2..........D3..........F3......C3......f3......G3......f3......C3..........f3..........G3......D3......F3......A3......F3......D3..........F3..........A3......D3......F3......A3......F3......D3..........F3..........A3......b2......D3......F3......D3......b2..........D3..........F3......C3......f3......G3......f3......C3..........f3..........G3......d3......f3......A3......f3......d3..........f3..........A3......d3......f3......A3......f3......d3..........f3..........A3......C3..............................................................A2..............................................................d3..............................................................d3..............................................d3......c3......A2..............A2..............c3..............c3..............d3..............d3..............d3..............c3..............A2..............A2..............c3..............c3..............C3..............C3..............d3..............................A2..............A2..............c3..............c3..............d3..............d3..............d3..............c3..............A2..............A2..............c3..............c3..............C3..............C3..............e3........e3........e3..........]]

	local tab = string.Explode("\n", GUNSTRUMENTAL_MERGE)
	self:Gunstrumentalize(tab[1] or "", tab[2] or "")
	
end

function PLUGIN:Gunstrumentalize( tab, harmonics )
	
	local tablen = string.len( tab )
	local harmonicslen = string.len( harmonics )
	
	if tablen < harmonicslen then
		tab = tab .. string.rep(".", harmonicslen -  tablen)
		
	elseif harmonicslen < tablen then
		harmonics = harmonics .. string.rep(".", tablen -  harmonicslen)
	
	end
	
	local size = 100
	local tabpos = 1
	local iPattern = 1
	while iPattern <= GUNSTRUMENTAL_NUM_VARS do
		if tabpos < tablen then
			timer.Simple(iPattern * 0.2 - 0.1, function(iPattern, tab, tabpos, size) chat.AddText( "setting "..iPattern) RunConsoleCommand("gs_zzapat"..iPattern, string.sub( tab, tabpos, tabpos + size - 1 ) ) end, iPattern, tab, tabpos, size)
			timer.Simple(iPattern * 0.2, function(iPattern, tab, tabpos, size) RunConsoleCommand("gs_zzbpat"..iPattern, string.sub( harmonics, tabpos, tabpos + size - 1 ) ) end, iPattern, tab, tabpos, size)
			tabpos = tabpos + size
			
		else
			timer.Simple(iPattern * 0.2 - 0.1, function(iPattern, tab, tabpos, size) chat.AddText( "emptying "..iPattern) RunConsoleCommand("gs_zzapat"..iPattern, "" ) end, iPattern, tab, tabpos, size)
			timer.Simple(iPattern * 0.2, function(iPattern, tab, tabpos, size) RunConsoleCommand("gs_zzbpat"..iPattern, "" ) end, iPattern, tab, tabpos, size)
			
		end
			
		iPattern = iPattern + 1
	end
	timer.Simple(iPattern * 0.2 + 0.1, function() chat.AddText("OK") end )
	
end